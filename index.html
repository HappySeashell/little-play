<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WWWå°å‰§åœºç”ŸæˆåŠ©æ‰‹</title>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ä½¿ç”¨è¯´æ˜æŒ‰é’® */
        .help-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .help-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            background: none;
            border: none;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal h2 {
            color: #3b82f6;
            margin-bottom: 15px;
        }

        .modal p {
            line-height: 1.8;
            color: #555;
            margin-bottom: 10px;
        }

        .modal a {
            color: #3b82f6;
            text-decoration: none;
        }

        .modal a:hover {
            text-decoration: underline;
        }

        /* å·¥å…·æ  */
        .toolbar {
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .toolbar button {
            background: white;
            border: 1px solid #cbd5e1;
            color: #475569;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .toolbar button:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* ä¸»ä½“å†…å®¹ */
        .content {
            padding: 30px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #334155;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .required::after {
            content: '*';
            color: #ef4444;
            margin-left: 4px;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .hint {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }

        /* å•é€‰æŒ‰é’®æ ·å¼ */
        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            margin-right: 8px;
        }

        /* è‡ªå®šä¹‰å­—æ®µåŒºåŸŸ */
        .custom-fields {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
        }

        .custom-field {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            position: relative;
        }

        .custom-field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .remove-field-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .remove-field-btn:hover {
            background: #dc2626;
        }

        .add-field-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
        }

        .add-field-btn:hover {
            background: #059669;
        }

        /* ç”ŸæˆæŒ‰é’® */
        .generate-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 30px;
            transition: transform 0.2s;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        /* è¾“å‡ºæ–‡æœ¬å— */
        .output-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .output-header h3 {
            color: #334155;
        }

        .copy-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .copy-btn:hover {
            background: #2563eb;
        }

        .output-box {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
        }

        .output-box:empty::before {
            content: 'ç‚¹å‡»"ä¸€é”®ç”Ÿæˆ"æŒ‰é’®ç”Ÿæˆå†…å®¹...';
            color: #64748b;
        }

        /* æç¤ºæ¶ˆæ¯ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            display: none;
            animation: slideIn 0.3s;
        }

        .toast.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 22px;
            }

            .help-btn {
                position: static;
                margin-top: 15px;
                width: 100%;
            }

            .toolbar {
                padding: 15px;
            }

            .content {
                padding: 20px;
            }

            .modal-content {
                padding: 20px;
            }
        }

        /* éšè—çš„æ–‡ä»¶è¾“å…¥ */
        #import-file {
            display: none;
        }

        /* éšæœºæ¬¡æ•°è¾“å…¥ */
        .repeat-count {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .repeat-count label {
            margin: 0;
            font-weight: normal;
            font-size: 14px;
        }

        .repeat-count input {
            width: 80px;
        }
    </style>
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>å°å‰§åœºç”ŸæˆåŠ©æ‰‹</h1>
            <p>â€”â€”ä½œè€…ï¼šWWW</p>
            <button class="help-btn" onclick="openHelp()">ä½¿ç”¨è¯´æ˜</button>
        </div>

        <!-- å·¥å…·æ  -->
        <div class="toolbar">
            <button onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            <button onclick="exportConfig()">ğŸ“¤ å¯¼å‡ºé…ç½®</button>
            <button onclick="document.getElementById('import-file').click()">ğŸ“¥ å¯¼å…¥é…ç½®</button>
            <input type="file" id="import-file" accept=".json" onchange="importConfig(event)">
        </div>

        <!-- ä¸»ä½“å†…å®¹ -->
        <div class="content">
            <form id="main-form">
                <!-- 1. æ ‡é¢˜ -->
                <div class="form-group">
                    <label class="required">å°å‰§åœºæ ‡é¢˜</label>
                    <input type="text" id="title" value="AU" required>
                </div>

                <!-- 2. ä½¿ç”¨æ¨¡å¼ -->
                <div class="form-group">
                    <label class="required">ä½¿ç”¨æ¨¡å¼</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="mode" value="independent" checked>
                            ç‹¬ç«‹ä½¿ç”¨
                        </label>
                        <label>
                            <input type="radio" name="mode" value="worldbook">
                            ä½œä¸ºå°å‰§åœºä¸–ç•Œä¹¦æ¡ç›®ä½¿ç”¨
                        </label>
                    </div>
                </div>

                <!-- 3. ç”Ÿæˆè¦æ±‚ -->
                <div class="form-group">
                    <label class="required">ç”Ÿæˆè¦æ±‚</label>
                    <textarea id="requirements" required>- æ•…äº‹ä¸­çš„è§’è‰²æ›´æ¢è‡³å…¶ä»–ä¸–ç•Œè§‚,ç”Ÿæˆä¸€æ®µå®Œæ•´çš„å°æ•…äº‹,ä»¥ä¸»è¦è§’è‰²é—´çš„å¯¹è¯å’Œäº’åŠ¨ä¸ºæ ¸å¿ƒ,å±•ç°è§’è‰²ä¹‹é—´çš„æƒ…æ„Ÿå…³ç³»,å†…å®¹è¶³å¤Ÿæ–°é¢–å¸å¼•äººã€‚
- è§’è‰²è‡ªåŠ¨é€‚é…ä¸ºè¯¥ä¸–ç•Œè§‚ä¸‹åˆé€‚çš„èº«ä»½,ä¸å¾—æ›´æ”¹ä¸ºè¯¥ä¸–ç•Œè§‚ä¸‹å·²å­˜åœ¨çš„è§’è‰²ã€‚ä¾‹å¦‚,å¦‚æœä¸–ç•Œè§‚æ˜¯åœ£æ¯æˆ˜äº‰,ä¸å¾—å°†{{user}}è®¾å®šä¸ºå«å®«åˆ‡å—£,è€Œæ˜¯è¦è®¾å®šä¸ºè¯¥ä¸–ç•Œè§‚ä¸‹åä¸º{{user}}çš„æ–°è§’è‰²ã€‚
- å¯æ ¹æ®éœ€è¦è¡¥å……èƒŒæ™¯æ¿NPCå‚ä¸å‰§æƒ…,ä½†ä¸èƒ½ç€å¢¨å¤ªå¤š,åªèƒ½ä½œä¸ºä¸»è¦è§’è‰²çš„è¡¬æ‰˜ã€‚</textarea>
                </div>

                <!-- 4. æ•…äº‹èƒŒæ™¯ -->
                <div class="form-group">
                    <label>æ•…äº‹èƒŒæ™¯</label>
                    <textarea id="background">è‡ªç”±å‘æŒ¥,
è§’è‰²ä»¬å‡ä¸ºè¿™ä¸ªä¸–ç•Œçš„åŸä½æ°‘,
è§’è‰²ä»¬å‡ä¸ºåˆšåˆšç©¿è¶Šæ¥åˆ°è¿™ä¸ªä¸–ç•Œçš„,
è§’è‰²ä»¬å‡ä¸ºç©¿è¶Šæ¥åˆ°è¿™ä¸ªä¸–ç•Œçš„ï¼Œå·²ç»ç©¿è¶Šå¾ˆä¹…äº†,
{{user}}å¸¦ç€å¿«ç©¿ç³»ç»Ÿç©¿è¶Šåˆ°è¿™ä¸ªä¸–ç•Œï¼Œè€Œ{{char}}æ˜¯è¿™ä¸ªä¸–ç•Œçš„åŸä½æ°‘ï¼Œ{{user}}çš„ä»»åŠ¡æ˜¯æ”»ç•¥{{char}},
{{char}}å¸¦ç€å¿«ç©¿ç³»ç»Ÿç©¿è¶Šåˆ°è¿™ä¸ªä¸–ç•Œï¼Œè€Œ{{user}}æ˜¯è¿™ä¸ªä¸–ç•Œçš„åŸä½æ°‘ï¼Œ{{char}}çš„ä»»åŠ¡æ˜¯æ”»ç•¥{{user}},
è§’è‰²ä»¬å¸¦ç€å¿«ç©¿ç³»ç»Ÿç©¿è¶Šåˆ°è¿™ä¸ªä¸–ç•Œï¼Œæœ‰ç€ä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡è¦å®Œæˆ,
è§’è‰²ä»¬è¢«è¿«ç©¿è¶Šåˆ°è¿™ä¸ªä¸–ç•Œï¼Œè¦å®Œæˆä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡æ‰èƒ½å›åˆ°åŸä¸–ç•Œ,
è§’è‰²ä»¬å¸¦ç€å‰ä¸–ï¼ˆä¸»çº¿ï¼‰çš„è®°å¿†æŠ•èƒåˆ°è¿™ä¸ªä¸–ç•Œ,
è§’è‰²ä»¬æŠ•èƒåˆ°è¿™ä¸ªä¸–ç•Œï¼Œä½†æ˜¯ä¸¢å¤±äº†å‰ä¸–ï¼ˆä¸»çº¿ï¼‰çš„è®°å¿†,
è§’è‰²ä»¬å¸¦ç€å‰ä¸–ï¼ˆä¸»çº¿ï¼‰çš„è®°å¿†åœ¨è¿™ä¸ªä¸–ç•Œè½®å›,
è§’è‰²ä»¬æ‰€åœ¨çš„è¿™ä¸ªä¸–ç•Œå®é™…ä¸Šæ˜¯è™šæ‹Ÿä¸–ç•Œï¼ŒTAä»¬ä¸çŸ¥é“è‡ªå·±èº«åœ¨è™šæ‹Ÿä¸–ç•Œä¸­ï¼Œè€Œä¸Šä½ä¸–ç•Œæœ‰ä¸€äº›è§‚ä¼—åœ¨å›´è§‚ä»–ä»¬çš„ç”Ÿæ´»ç›´æ’­,
è§’è‰²ä»¬æ‰€åœ¨çš„è¿™ä¸ªä¸–ç•Œå®é™…ä¸Šæ˜¯è™šæ‹Ÿä¸–ç•Œï¼ŒTAä»¬çŸ¥é“è‡ªå·±èº«åœ¨è™šæ‹Ÿä¸–ç•Œä¸­ï¼Œè€Œä¸Šä½ä¸–ç•Œæœ‰ä¸€äº›è§‚ä¼—åœ¨å›´è§‚ä»–ä»¬çš„ç”Ÿæ´»ç›´æ’­ï¼ŒTAä»¬éœ€è¦æ»¡è¶³è§‚ä¼—çš„ä¸€äº›è¦æ±‚,
{{char}}æ˜¯{{user}}å‰ä¸–ï¼ˆä¸»çº¿å‰§æƒ…ï¼‰çš„æ‹äººï¼Œä½†æ˜¯{{user}}å·²ç»å¿˜äº†{{char}},
{{user}}æ˜¯{{char}}å‰ä¸–ï¼ˆä¸»çº¿å‰§æƒ…ï¼‰çš„æ‹äººï¼Œä½†æ˜¯{{char}}å·²ç»å¿˜äº†{{user}},
{{char}}å’Œ{{user}}æ˜¯å‰ä¸–ï¼ˆä¸»çº¿å‰§æƒ…ï¼‰çš„æ‹äººï¼Œä½†æ˜¯TAä»¬å·²ç»å¿˜äº†å½¼æ­¤,
{{char}}è¢«å›°åœ¨äº†è¿™ä¸ªä¸–ç•Œé‡Œï¼Œè€Œ{{user}}æ˜¯æ¥æ•‘TAå‡ºå»çš„,
{{user}}è¢«å›°åœ¨äº†è¿™ä¸ªä¸–ç•Œé‡Œï¼Œè€Œ{{char}}æ˜¯æ¥æ•‘TAå‡ºå»çš„
</textarea>
                    <div class="hint">å½“éœ€è¦åœ¨å¤šä¸ªèƒŒæ™¯ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ—¶,è¯·ç”¨è‹±æ–‡é€—å·åˆ†éš”</div>
                </div>

                <!-- 5. æ–‡é£è¦æ±‚ -->
                <div class="form-group">
                    <label>æ–‡é£è¦æ±‚</label>
                    <textarea id="style">æ­£å‰§,
å²è¯—æ„Ÿ,
è½»æ¾è¯™è°åæ§½,
æç¬‘æ’•é€¼,
è™å‘,
çº¯çˆ±ç…½æƒ…,
NSFW</textarea>
                    <div class="hint">å½“éœ€è¦åœ¨å¤šä¸ªæ–‡é£ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ—¶,è¯·ç”¨è‹±æ–‡é€—å·åˆ†éš”</div>
                </div>

                <!-- 6. ä¸–ç•Œè§‚&é¢˜æè¦æ±‚ -->
                <div class="form-group">
                    <label class="required">ä¸–ç•Œè§‚/é¢˜æè¦æ±‚</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="worldview" value="consistent" onchange="toggleWorldviewInput()">
                            å’Œä¸»çº¿ä¸€è‡´
                        </label>
                        <label>
                            <input type="radio" name="worldview" value="custom" checked onchange="toggleWorldviewInput()">
                            è‡ªå®šä¹‰
                        </label>
                    </div>
                    <textarea id="worldview-custom" style="margin-top: 10px;">è‡ªç”±æŒ‡å®šä¸€ä¸ªAU,è‡ªç”±æŒ‡å®šä¸€ä¸ªæ¸¸æˆAU,è‡ªç”±æŒ‡å®šä¸€ä¸ªç°å®ä½œå“çš„AU,
è™«æ—ï¼ˆç¤¾ä¼šç»“æ„åŒ…å«è™«æ¯ã€é›„è™«ã€äºšé›Œï¼Œè™«æ¯ä¸ºå°Šï¼‰,è™«æ—ï¼ˆç¤¾ä¼šç»“æ„åŒ…å«é›„è™«ã€é›Œè™«ã€äºšé›Œï¼Œé›„è™«ä¸ºå°Šï¼Œé›Œè™«å¤§éƒ¨åˆ†ä¸ºå†›é›Œï¼‰,å“¨å…µå‘å¯¼,ABO,dom/sub,å…½äºº,
é¾™å‚²å¤©æ–‡å­¦,ç‹—è¡€å°è¨€æ–‡,æ‹çˆ±å°‘å¥³æ¼«,çƒ­è¡€å°‘å¹´æ¼«,æ™‹æ±Ÿæ–‡å­¦,æµ·æ£ æ–‡å­¦,
å…‹è‹é²,è¡€æ—,åœ£æ¯æˆ˜äº‰,é­”æ³•å°‘å¥³å°åœ†,EVA,éœæ ¼æ²ƒå…¹,è¶…çº§è‹±é›„,ç›—å¢“ç¬”è®°,é»‘å¡”åˆ©äºš,JOJOçš„å¥‡å¦™å†’é™©ï¼ˆå¯ä»¥ä½œä¸ºæ›¿èº«ä½¿è€…æˆ–æ›¿èº«ï¼‰,è¥¿æ¸¸è®°,
èµ›åšæœ‹å…‹2077,åº•ç‰¹å¾‹å˜äºº,é˜´é˜³å¸ˆæ‰‹æ¸¸,å‰‘ç½‘ä¸‰,
è¥¿å¹»,DND,
è’¸æ±½æœ‹å…‹,èµ›åšæœ‹å…‹,ææ€–æ€ªè°ˆ,è§„åˆ™æ€ªè°ˆ,æ˜Ÿé™…,æ˜Ÿé™…æœºç”²,æ˜Ÿçƒå¤§æˆ˜,æ— é™ææ€–,æ— é™æµ,
è¿‘æœªæ¥,ç§‘å¹»,æœ«ä¸–åºŸåœŸ,åå¯ç¤ºå½•,æœ«æ—¥å°†è‡³,æœ«ä¸–ç§ç”°,æœ«ä¸–å¼‚èƒ½,
æ¶ç©ºå†å²,ä¸­å›½å¤ä»£,æ˜¥ç§‹æˆ˜å›½,ç§¦æœ,ä¸‰å›½,å”æœ,å®‹æœ,æ˜æœ,æ¸…æœ,æ°‘å›½,é©å‘½å¹´ä»£,çŸ¥é’ä¸‹ä¹¡,
æ—¥æœ¬å¹³å®‰æ—¶ä»£,æ—¥æœ¬æ±Ÿæˆ·æ—¶ä»£,æ—¥æœ¬å¤§æ­£æ—¶ä»£,
æ¬§æ´²ä¸­ä¸–çºª,æ¬§æ´²æ–‡è‰ºå¤å…´æ—¶æœŸ,æ¬§æ´²è¿‘ä»£,
ä¸€æˆ˜,äºŒæˆ˜,æˆ˜äº‰å¹´ä»£,ç¬¬ä¸‰æ¬¡ä¸–ç•Œå¤§æˆ˜,
æ­¦ä¾ ,æ­¦ä¾ ï¼ˆé‡‘åº¸ä½œå“ï¼‰,ä¸­å¼ç„å¹»,ä»™ä¾ ä¿®çœŸ,ä¸­å¼å¦–ç¥,
æ¶ç©ºç¥è¯,å¸Œè…Šç¥è¯,å¸Œä¼¯æ¥ç¥è¯,å°åº¦ç¥è¯,åŸƒåŠç¥è¯,ä¸­å›½æ´ªè’ç¥è¯,ä¸­å›½ç¥è¯,æ—¥æœ¬å¦–ç¥,
å·¥åœ°æƒ…ç¼˜(TAä»¬æ˜¯å·¥å‹),é’æ˜¥æ ¡å›­,å¨±ä¹åœˆï¼ˆç»¼è‰º/å›¢ç»¼å‡ºé“/æ¼”å‘˜ï¼‰,å°å¦ˆæ–‡å­¦,é»‘å¸®,è­¦åŒªï¼ˆçŒ«é¼ æ¸¸æˆï¼‰,æ¨ç†ç ´æ¡ˆ</textarea>
                    <div class="hint">å½“éœ€è¦åœ¨å¤šä¸ªä¸–ç•Œè§‚/é¢˜æä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ—¶,è¯·ç”¨è‹±æ–‡é€—å·åˆ†éš”</div>
                </div>

                <!-- 7. ç¯‡å¹…è¦æ±‚ -->
                <div class="form-group">
                    <label class="required">ç¯‡å¹…è¦æ±‚</label>
                    <input type="number" id="length" value="2000" min="1" required>
                </div>

                <!-- 8. ä½“è£è¦æ±‚ -->
                <div class="form-group">
                    <label>ä½“è£è¦æ±‚</label>
                    <textarea id="genre">è‡ªç”±å‘æŒ¥,è¯—æ­Œ,æˆå‰§,ç”µå½±åˆ†é•œ,å°è¯´,è§†è§‰å°è¯´,è®ºæ–‡,ç ”ç©¶æŠ¥å‘Š,æ•£æ–‡,æ‚æ–‡,æ—¥è®°,å›å¿†å½•,äººç‰©æ¡£æ¡ˆ,è®ºå›å¸–å­,ä¸ªäººä¸»é¡µ,è¯­å½•,ç®´è¨€,æ‘˜æŠ„,æ–°é—»æŠ¥é“,ç®€æŠ¥,å…¬å‘Š,æ—¥å¿—,ç¬”è®°,å½’æ¡£è®°å½•,æœ‹å‹åœˆ,å›å¿†ç›¸å†Œ</textarea>
                    <div class="hint">å½“éœ€è¦åœ¨å¤šä¸ªä½“è£ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ—¶,è¯·ç”¨è‹±æ–‡é€—å·åˆ†éš”</div>
                </div>

                <!-- 9. å…ƒç´ è¦æ±‚ -->
                <div class="form-group">
                    <label>å…ƒç´ è¦æ±‚</label>
                    <textarea id="elements">è‡ªç”±å‘æŒ¥ï¼Œè¶Šç‹—è¡€è¶Šæ¶ä¿—è¶Šå¥½,é‡Œç•ªç»å…¸å‰§æƒ…,éœ¸æ€»æ–‡å­¦ç»å…¸å‰§æƒ…,è¨€æƒ…ç»å…¸å‰§æƒ…,ç›ä¸½è‹æ–‡å­¦ç»å…¸å‰§æƒ…,é¾™å‚²å¤©æ–‡å­¦ç»å…¸å‰§æƒ…,è¿ªåŒ–æµç»å…¸å‰§æƒ…,å°å¦ˆæ–‡å­¦,å…ˆå©šåçˆ±,å©šç¤¼å½“å¤©æŠ¢å©š,èµ›åšå¿æ‚”å®¤,ç¤¾æ­»ç°åœº,å®«å»·æƒè°‹,å›šç¦play,ç½‘æ‹å¥”ç°,ç§å¥”</textarea>
                    <div class="hint">å½“éœ€è¦åœ¨å¤šä¸ªå…ƒç´ ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ—¶,è¯·ç”¨è‹±æ–‡é€—å·åˆ†éš”ã€‚â€œä¸ªæ•°â€ç”¨äºæŒ‡å®šéœ€è¦é€‰æ‹©çš„éšæœºå…ƒç´ ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŠŠâ€œä¸ªæ•°â€è®¾ç½®æˆ3ï¼Œåˆ™ä¼šåœ¨å…ƒç´ åˆ—è¡¨é‡Œè¿›è¡Œä¸‰æ¬¡æŠ½å–ã€‚</div>
                    <div class="repeat-count">
                        <label>æŠ½å–æ¬¡æ•°:</label>
                        <input type="number" id="elements-repeat" value="1" min="1" max="99">
                    </div>
                </div>

                <!-- è‡ªå®šä¹‰å­—æ®µåŒºåŸŸ -->
                <div class="custom-fields">
                    <h3 style="margin-bottom: 20px; color: #334155;">è‡ªå®šä¹‰å­—æ®µ</h3>
                    <div id="custom-fields-container"></div>
                    <button type="button" class="add-field-btn" onclick="addCustomField()">â• æ·»åŠ è‡ªå®šä¹‰å­—æ®µ</button>
                </div>

                <!-- ç”ŸæˆæŒ‰é’® -->
                <button type="button" class="generate-btn" onclick="generateOutput()">ğŸ­ ä¸€é”®ç”Ÿæˆ</button>
            </form>

            <!-- è¾“å‡ºæ–‡æœ¬å— -->
            <div class="output-section">
                <div class="output-header">
                    <h3>ç”Ÿæˆç»“æœ</h3>
                    <button class="copy-btn" onclick="copyOutput()">ğŸ“‹ å¤åˆ¶</button>
                </div>
                <div class="output-box" id="output"></div>
            </div>
        </div>
    </div>

    <!-- ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡† -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHelp()">âœ•</button>
            <h2>ä½¿ç”¨è¯´æ˜</h2>
            <p>æœ¬å·¥å…·å¯ä»¥ç”Ÿæˆæ ¼å¼åŒ–çš„å°å‰§åœº,å¹¶å¯é€šè¿‡é…’é¦†æä¾›çš„å®{{random:...}}æ¥è¿›è¡Œéšæœºé€‰é¡¹é€‰æ‹©ï¼Œæå‡ç”Ÿæˆå¤šæ ·æ€§ã€‚è¿˜æ”¯æŒæ·»åŠ è‡ªå®šä¹‰å­—æ®µï¼Œå¡«å†™ä½ æƒ³è¦å®ç°çš„è¦æ±‚ã€‚åœ¨å‘é€åˆ°é…’é¦†èŠå¤©é‡Œæ—¶ï¼Œ{{random:...}}å†…çš„é€‰é¡¹åªä¼šæœ‰ä¸€ä¸ªè¢«éšæœºé€‰æ‹©æ˜¾ç¤ºå‡ºæ¥ï¼Œä¸ä¼šéƒ½å‘é€ç»™AIã€‚</p>
            <p>ç‚¹å‡»ä¸Šæ–¹â€œä¿å­˜é…ç½®â€æŒ‰é’®å¯ä»¥ä¿å­˜é…ç½®ã€‚ç‚¹å‡»â€œå¯¼å…¥/å¯¼å‡ºé…ç½®â€å¯ä»¥å°†é…ç½®æ–‡ä»¶ä»¥JSONæ ¼å¼å¯¼å…¥/å¯¼å‡ºï¼Œæ–¹ä¾¿åˆ†äº«ã€‚</p>
            <p>æ›´æ–°é“¾æ¥: <a href="https://discord.com/channels/1291925535324110879/1421177491959316570/1421177491959316570" target="_blank">Discordæ›´æ–°é“¾æ¥</a>ã€‚åŒæ—¶æˆ‘ä¹Ÿåœ¨å†™ä¸€ç³»åˆ—å°å‰§åœºå’Œå°å·¥å…·ï¼Œæ¬¢è¿ä½“éªŒå’Œrepo~~æœ‰å¥½é¥­èƒ½è®©æˆ‘ä¹Ÿåƒä¸€åƒå—ğŸ¥¹</p>
        </div>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast" id="toast"></div>

    <script>
        // è‡ªå®šä¹‰å­—æ®µè®¡æ•°å™¨
        let customFieldCounter = 0;

        // é¡µé¢åŠ è½½æ—¶åŠ è½½ä¿å­˜çš„é…ç½®
        window.onload = function() {
            loadConfig();
        };

        // æ‰“å¼€ä½¿ç”¨è¯´æ˜
        function openHelp() {
            document.getElementById('help-modal').classList.add('active');
        }

        // å…³é—­ä½¿ç”¨è¯´æ˜
        function closeHelp() {
            document.getElementById('help-modal').classList.remove('active');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('help-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeHelp();
            }
        });

        // åˆ‡æ¢ä¸–ç•Œè§‚è¾“å…¥æ¡†
        function toggleWorldviewInput() {
            const customRadio = document.querySelector('input[name="worldview"][value="custom"]');
            const customTextarea = document.getElementById('worldview-custom');
            customTextarea.disabled = !customRadio.checked;
            customTextarea.style.display = customRadio.checked ? 'block' : 'none';
        }

        // æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
        function addCustomField() {
            customFieldCounter++;
            const container = document.getElementById('custom-fields-container');
            const fieldId = 'custom-field-' + customFieldCounter;
            
            const fieldHtml = `
                <div class="custom-field" id="${fieldId}">
                    <div class="custom-field-header">
                        <h4>è‡ªå®šä¹‰å­—æ®µ #${customFieldCounter}</h4>
                        <button type="button" class="remove-field-btn" onclick="removeCustomField('${fieldId}')">åˆ é™¤</button>
                    </div>
                    <div class="form-group">
                        <label>å­—æ®µåç§°</label>
                        <input type="text" class="field-name" placeholder="ä¾‹å¦‚:è§’è‰²å…³ç³»ã€">
                    </div>
                    <div class="form-group">
                        <label>å­—æ®µç±»å‹</label>
                        <select class="field-type" onchange="updateFieldInput(this, '${fieldId}')">
                            <option value="text">å¸¸é©»å­—æ®µ</option>
                            <option value="random">éšæœºå­—æ®µ</option>
                        </select>
                    </div>
                    <div class="form-group field-input-container">
                        <label>å­—æ®µå†…å®¹</label>
                        <textarea class="field-content" placeholder="è¯·è¾“å…¥å†…å®¹"></textarea>
                        <div class="hint">å½“éœ€è¦åœ¨å¤šä¸ªé€‰é¡¹ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ—¶,è¯·é€‰æ‹©éšæœºå­—æ®µï¼Œå¹¶ç”¨è‹±æ–‡é€—å·åˆ†éš”ä¸åŒé€‰é¡¹ã€‚</div>
                    </div>
                    <div class="repeat-count" style="display: none;">
                        <label>æŠ½å–æ¬¡æ•°:</label>
                        <input type="number" class="field-repeat" value="1" min="1" max="99">
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', fieldHtml);
        }

        // åˆ é™¤è‡ªå®šä¹‰å­—æ®µ
        function removeCustomField(fieldId) {
            document.getElementById(fieldId).remove();
        }

        // æ›´æ–°å­—æ®µè¾“å…¥æ–¹å¼
        function updateFieldInput(select, fieldId) {
            const field = document.getElementById(fieldId);
            const repeatCountDiv = field.querySelector('.repeat-count');
            
            if (select.value === 'random') {
                repeatCountDiv.style.display = 'flex';
            } else {
                repeatCountDiv.style.display = 'none';
            }
        }

        // ç”Ÿæˆè¾“å‡ºå†…å®¹
        function generateOutput() {
            let output = '';
            
            // è·å–è¡¨å•å€¼
            const title = document.getElementById('title').value.trim();
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const requirements = document.getElementById('requirements').value.trim();
            const background = document.getElementById('background').value.trim();
            const style = document.getElementById('style').value.trim();
            const worldviewMode = document.querySelector('input[name="worldview"]:checked').value;
            const worldviewCustom = document.getElementById('worldview-custom').value.trim();
            const length = document.getElementById('length').value;
            const genre = document.getElementById('genre').value.trim();
            const elements = document.getElementById('elements').value.trim();
            const elementsRepeat = parseInt(document.getElementById('elements-repeat').value);

            // æ ¹æ®ä½¿ç”¨æ¨¡å¼æ·»åŠ å¼€å§‹æ ‡ç­¾
            if (mode === 'worldbook') {
                output += '<little-play>\n';
            }

            // æ ‡é¢˜
            output += `ã€å°å‰§åœºÂ·${title}ã€‘\næ•´ä½“è¦æ±‚:\n`;

            // ä½¿ç”¨æ¨¡å¼
            if (mode === 'independent') {
                output += '- æœ¬æ¬¡å›å¤éœ€æš‚åœä¸€åˆ‡æ­£æ–‡è¾“å‡º,ç«‹åˆ»è¾“å‡ºæœ¬å‰§åœºå†…å®¹ã€‚\n';
            }

            // ç”Ÿæˆè¦æ±‚
            if (requirements) {
                output += requirements + '\n';
            }

            // å›ºå®šè¦æ±‚
            output += '- å°å‰§åœºæ ‡é¢˜éœ€æ ¹æ®å†…å®¹åŠ¨æ€ç”Ÿæˆã€‚\n';
            output += '- å‰§æƒ…å¿…é¡»å®Œæ•´,ä»å¼€å¤´åˆ°ç»“å°¾,ä¸èƒ½ä»…æ˜¯å‰§æƒ…ç‰‡æ®µã€‚\n';

            // æ•…äº‹èƒŒæ™¯
            if (background) {
                output += `- æ•…äº‹èƒŒæ™¯: {{random:${background}}}\n`;
            }

            // æ–‡é£è¦æ±‚
            if (style) {
                output += `- æ–‡é£: {{random:${style}}}\n`;
            }

            // ä¸–ç•Œè§‚&é¢˜æ
            if (worldviewMode === 'consistent') {
                output += '- å‰§åœºå†…å®¹æ ¹æ®ä¸»çº¿å‰§æƒ…å’Œå½“å‰ä¸–ç•Œè§‚åŠ¨æ€é€‚é…ã€‚\n';
            } else if (worldviewCustom) {
                output += `- ä¸–ç•Œè§‚/é¢˜æ: {{random:${worldviewCustom}}}\n`;
            }

            // ç¯‡å¹…è¦æ±‚
            if (length) {
                output += `- ç¯‡å¹…: â‰¥${length}å­—\n`;
            }

            // ä½“è£è¦æ±‚
            if (genre) {
                output += `- ä½“è£: {{random:${genre}}}\n`;
            }

            // å…ƒç´ è¦æ±‚
            if (elements) {
                output += '- å…ƒç´ è¦æ±‚: ';
                const elementParts = [];
                for (let i = 0; i < elementsRepeat; i++) {
                    elementParts.push(`{{random:${elements}}}`);
                }
                output += elementParts.join(';') + '\n';
            }

            // è‡ªå®šä¹‰å­—æ®µ
            const customFields = document.querySelectorAll('.custom-field');
            customFields.forEach(field => {
                const name = field.querySelector('.field-name').value.trim();
                const type = field.querySelector('.field-type').value;
                const content = field.querySelector('.field-content').value.trim();
                const repeat = parseInt(field.querySelector('.field-repeat').value);

                if (name && content) {
                    if (type === 'random') {
                        output += `- ${name}: `;
                        const parts = [];
                        for (let i = 0; i < repeat; i++) {
                            parts.push(`{{random:${content}}}`);
                        }
                        output += parts.join(';') + '\n';
                    } else {
                        output += `- ${name}: ${content}\n`;
                    }
                }
            });

            // æ ¹æ®ä½¿ç”¨æ¨¡å¼æ·»åŠ ç»“æŸæ ‡ç­¾
            if (mode === 'worldbook') {
                output += '</little-play>';
            }

            // æ˜¾ç¤ºè¾“å‡º
            document.getElementById('output').textContent = output;
        }

        // å¤åˆ¶è¾“å‡ºå†…å®¹
        function copyOutput() {
            const output = document.getElementById('output').textContent;
            if (!output || output === 'ç‚¹å‡»"ä¸€é”®ç”Ÿæˆ"æŒ‰é’®ç”Ÿæˆå†…å®¹...') {
                showToast('è¯·å…ˆç‚¹å‡»æŒ‰é’®æ¥ç”Ÿæˆå†…å®¹!', 'error');
                return;
            }

            navigator.clipboard.writeText(output).then(() => {
                showToast('å¤åˆ¶æˆåŠŸ!');
            }).catch(() => {
                showToast('å¤åˆ¶å¤±è´¥,è¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            });
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'success' ? '#10b981' : '#ef4444';
            toast.classList.add('active');
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            const config = collectConfig();
            try {
                localStorage.setItem('theaterGeneratorConfig', JSON.stringify(config));
                showToast('é…ç½®ä¿å­˜æˆåŠŸ!');
            } catch (e) {
                showToast('ä¿å­˜å¤±è´¥', 'error');
            }
        }

        // åŠ è½½é…ç½®
        function loadConfig() {
            try {
                const saved = localStorage.getItem('theaterGeneratorConfig');
                if (saved) {
                    const config = JSON.parse(saved);
                    applyConfig(config);
                }
            } catch (e) {
                console.error('åŠ è½½é…ç½®å¤±è´¥', e);
            }
        }

        // æ”¶é›†å½“å‰é…ç½®
        function collectConfig() {
            const config = {
                title: document.getElementById('title').value,
                mode: document.querySelector('input[name="mode"]:checked').value,
                requirements: document.getElementById('requirements').value,
                background: document.getElementById('background').value,
                style: document.getElementById('style').value,
                worldviewMode: document.querySelector('input[name="worldview"]:checked').value,
                worldviewCustom: document.getElementById('worldview-custom').value,
                length: document.getElementById('length').value,
                genre: document.getElementById('genre').value,
                elements: document.getElementById('elements').value,
                elementsRepeat: document.getElementById('elements-repeat').value,
                customFields: []
            };

            // æ”¶é›†è‡ªå®šä¹‰å­—æ®µ
            const customFields = document.querySelectorAll('.custom-field');
            customFields.forEach(field => {
                config.customFields.push({
                    name: field.querySelector('.field-name').value,
                    type: field.querySelector('.field-type').value,
                    content: field.querySelector('.field-content').value,
                    repeat: field.querySelector('.field-repeat').value
                });
            });

            return config;
        }

        // åº”ç”¨é…ç½®
        function applyConfig(config) {
            document.getElementById('title').value = config.title || 'ç•ªå¤–';
            document.querySelector(`input[name="mode"][value="${config.mode}"]`).checked = true;
            document.getElementById('requirements').value = config.requirements || '';
            document.getElementById('background').value = config.background || '';
            document.getElementById('style').value = config.style || '';
            document.querySelector(`input[name="worldview"][value="${config.worldviewMode}"]`).checked = true;
            document.getElementById('worldview-custom').value = config.worldviewCustom || '';
            toggleWorldviewInput();
            document.getElementById('length').value = config.length || '2000';
            document.getElementById('genre').value = config.genre || '';
            document.getElementById('elements').value = config.elements || '';
            document.getElementById('elements-repeat').value = config.elementsRepeat || '1';

            // æ¸…ç©ºå¹¶é‡å»ºè‡ªå®šä¹‰å­—æ®µ
            document.getElementById('custom-fields-container').innerHTML = '';
            customFieldCounter = 0;
            
            if (config.customFields && config.customFields.length > 0) {
                config.customFields.forEach(field => {
                    addCustomField();
                    const fieldElement = document.getElementById('custom-field-' + customFieldCounter);
                    fieldElement.querySelector('.field-name').value = field.name;
                    fieldElement.querySelector('.field-type').value = field.type;
                    fieldElement.querySelector('.field-content').value = field.content;
                    fieldElement.querySelector('.field-repeat').value = field.repeat;
                    updateFieldInput(fieldElement.querySelector('.field-type'), 'custom-field-' + customFieldCounter);
                });
            }
        }

        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            const config = collectConfig();
            const dataStr = JSON.stringify(config, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'å°å‰§åœºé…ç½®_' + new Date().getTime() + '.json';
            link.click();
            URL.revokeObjectURL(url);
            showToast('é…ç½®å¯¼å‡ºæˆåŠŸ!');
        }

        // å¯¼å…¥é…ç½®
        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    applyConfig(config);
                    showToast('é…ç½®å¯¼å…¥æˆåŠŸ!');
                } catch (error) {
                    showToast('å¯¼å…¥å¤±è´¥,æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                }
            };
            reader.readAsText(file);
            
            // é‡ç½®æ–‡ä»¶è¾“å…¥,å…è®¸é‡å¤å¯¼å…¥åŒä¸€æ–‡ä»¶
            event.target.value = '';
        }
    </script>
</body>
</html>